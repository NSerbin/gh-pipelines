name: Terraform Plan

on:
  workflow_call:
    inputs:
      terraform_version:
        required: true
        type: string
        default: 1.8.3


jobs:
  terraform_plan:
    name: Terraform Plan
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4.1.6
        with:
          fetch-depth: 0
      - name: Cache repository
        uses: actions/cache@v4.0.2
        with:
          path: repo
          key: ${{ runner.os }}-checkout-${{ github.sha }}
          restore-keys: |
            ${{ runner.os }}-checkout-${{ github.sha }}
            ${{ runner.os }}-checkout-
      - name: Terraform Prepare
        uses: ./tf-prepare.yml
      - name: Terraform Init
        uses: ./tf-init.yml
      - name: Terraform Plan
        id: plan
        run: terraform plan 
